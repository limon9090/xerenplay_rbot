<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>X-Eren Play</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Ad Scripts -->
    <script src='//jagnaimsee.net/vignette.min.js' data-zone='9504240' data-sdk='show_9504240'></script>
    <script src="https://ad.gigapub.tech/script?id=2086"></script>
    
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --font-main: 'Inter', 'Hind Siliguri', sans-serif;
            --primary-color: #6A5ACD; /* SlateBlue */
            --primary-gradient: linear-gradient(135deg, #6A5ACD, #836FFF);
            --primary-light: #F2F0FF;
            --secondary-color: #007AFF;
            --tertiary-color: #FF9500;
            --success-color: #34C759;
            --danger-color: #FF3B30;
            --pending-color: #FF9500;
            --premium-color: #AF52DE;
            --bg-color: #F7F8FC;
            --card-bg: #FFFFFF;
            --text-dark: #1C1C1E;
            --text-light: #8A8A8E;
            --border-color: #EAEAEA;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --button-shadow: 0 6px 20px rgba(106, 90, 205, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); }
        
        body { background-color: var(--bg-color); color: var(--text-dark); overflow-x: hidden; min-height: 100vh; }
        .app-container { width: 100%; max-width: 480px; margin: 0 auto; padding-bottom: 80px; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* Header */
        .app-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background-color: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .header-btn { background: none; border: none; cursor: pointer; font-size: 1.8rem; color: var(--text-dark); width: 44px; height: 44px; }
        .header-title-group { display: flex; align-items: center; gap: 10px; }
        .header-title-group img { height: 30px; }
        .header-title { font-size: 1.3rem; font-weight: 700; }
        .header-with-back { padding: 15px; background-color: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        
        .content-area { padding: 0 15px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: var(--card-shadow); }
        .section-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; }
        .sub-section-title { font-size: 1.2rem; font-weight: 600; color: var(--text-dark); margin-top: 30px; margin-bottom: 15px; border-left: 4px solid var(--primary-color); padding-left: 10px; }

        /* Main View */
        .user-info-header { background: var(--card-bg); padding: 15px; border-radius: 16px; display: flex; align-items: center; gap: 15px; margin-bottom: 20px; box-shadow: var(--card-shadow); }
        .user-info-header .avatar img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .user-info-header .details .name { font-weight: 600; font-size: 1.1rem; }
        .user-info-header .details .sub-details { font-size: 0.8rem; color: var(--text-light); }
        .balance-card { background: var(--primary-gradient); color: white; padding: 25px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 15px 30px rgba(106, 90, 205, 0.4); text-align: left; position: relative; overflow: hidden; }
        .balance-card .coin-info { display: flex; align-items: center; gap: 12px; margin-bottom: 8px;}
        .balance-card .coin-info i { font-size: 2.2rem; opacity: 0.8; }
        .balance-card .value { font-size: 2.5em; font-weight: 700; letter-spacing: 1px; }
        #cooldownTimerDisplay, #adsterraCooldownTimerDisplay { font-weight: 600; color: var(--danger-color); text-align: center; display: none; background-color: #ff3b3020; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        
        /* Action Buttons & Cards */
        .action-btn { background-image: var(--primary-gradient); color: white; border: none; border-radius: 14px; padding: 16px; font-size: 1.1em; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: var(--button-shadow); transition: all 0.2s ease; text-decoration: none; }
        .action-btn:disabled { background-image: none; background-color: #C7C7CC; color: #8A8A8E; cursor: not-allowed; transform: none; box-shadow: none; }
        .action-btn.auto-ad-active { background-image: none; background-color: var(--danger-color); box-shadow: 0 4px 15px rgba(255, 59, 48, 0.4); }
        
        .ad-list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .ad-list-item:last-child { border-bottom: none; }
        .ad-list-item .info { flex-grow: 1; }
        .ad-list-item .info .title { font-weight: 600; font-size: 1.1rem; }
        .ad-list-item .info .details { font-size: 0.9rem; color: var(--text-light); }
        .ad-list-item .ad-btn { padding: 10px 25px; font-size: 1rem; flex-shrink: 0; margin-left: 15px;}
        .ad-btn-monetag { background-color: var(--secondary-color); box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3); }
        .ad-btn-adsterra { background-color: var(--tertiary-color); box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3); }

        /* Withdraw View Specific */
        .policy-btn { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); width: 100%; padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer; margin-bottom: 20px; }
        
        /* Exchange View */
        .exchange-card { text-align: center; padding: 30px 20px; background: var(--primary-gradient); color: white; border-radius: 20px; box-shadow: var(--card-shadow); }
        .exchange-card .icon { font-size: 4rem; margin-bottom: 15px; opacity: 0.8; }
        .exchange-rate { font-size: 1.8rem; font-weight: 700; margin-bottom: 10px; }
        .exchange-note { font-size: 1rem; opacity: 0.9; }

        /* Universal Components */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--text-light); }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 10px; font-size: 1rem; background-color: var(--bg-color); }

        /* FAB & Footer */
        .fab-support { position: fixed; bottom: 80px; right: 20px; z-index: 999; width: 60px; height: 60px; border-radius: 50%; background-image: var(--primary-gradient); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(106, 90, 205, 0.4); animation: pulse 2s infinite; }
        .fab-support i { font-size: 1.8rem; }
        @keyframes pulse { 0% { box-shadow: 0 5px 15px rgba(106, 90, 205, 0.4); } 50% { box-shadow: 0 5px 25px rgba(106, 90, 205, 0.6); } 100% { box-shadow: 0 5px 15px rgba(106, 90, 205, 0.4); } }
        .app-footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--card-bg); padding: 15px; text-align: center; border-top: 1px solid var(--border-color); font-size: 0.9em; z-index: 100; }
        .developer-credit a { color: var(--text-light); text-decoration: none; font-weight: 500; }

        /* History View */
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); }
        .history-item:last-child { border-bottom: none; }
        .history-item .details .amount { font-weight: 600; font-size: 1.1rem; }
        .history-item .details .info { font-size: 0.9rem; color: var(--text-light); }
        .history-item .status { padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.8rem; }
        .status.pending { background-color: var(--pending-color); color: white; }
        .status.completed { background-color: var(--success-color); color: white; }
        .no-history { text-align: center; color: var(--text-light); padding: 40px 20px; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1010; display: none; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 16px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-title { font-size: 1.3rem; font-weight: 700; }
        .modal-close-btn { background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--text-light); }
        .modal-body ul { list-style: none; padding-left: 5px; }
        .modal-body ul li { margin-bottom: 12px; line-height: 1.5; }
        .modal-body ul i { color: var(--primary-color); margin-right: 10px; }
        
        /* Navigation Bar */
        .nav-bar { position: fixed; bottom: 60px; left: 0; right: 0; background-color: var(--card-bg); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid var(--border-color); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-light); font-size: 0.8rem; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item i { font-size: 1.5rem; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Dashboard View -->
        <div id="mainView" class="view active">
            <header class="app-header">
                <div class="header-title-group"><img src="https://i.ibb.co/WvZM7FHw/1000091009.png" alt="Logo"><div class="header-title">X-Eren Play</div></div>
                <button id="supportBtn" class="header-btn" data-view-btn="supportView"><i class="bi bi-headset"></i></button>
            </header>
            <main class="content-area">
                <div class="user-info-header">
                    <div class="avatar"><img id="userInfoProfilePic" src="https://i.ibb.co/Q8Q2d6T/avatar.png" alt="Avatar"></div>
                    <div class="details">
                        <div id="userInfoName" class="name">Guest User</div>
                        <div class="sub-details"><span id="userInfoId">ID: N/A</span> | <span id="joinDateDisplay">Joined: ...</span></div>
                    </div>
                </div>
                
                <script type="text/javascript">
                    atOptions = { 'key' : '7edfad08e30e6ff9b7aab91dfe3b4c9b', 'format' : 'iframe', 'height' : 90, 'width' : 350, 'params' : {} };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/7edfad08e30e6ff9b7aab91dfe3b4c9b/invoke.js"></script>
                
                <div class="balance-card">
                    <div class="coin-info"><i class="bi bi-wallet-fill"></i><p class="coin-name">X-Coin Balance</p></div>
                    <h2 class="value" id="balanceDisplay">0.00</h2>
                </div>
                
                <div class="card">
                    <h3 class="section-title" style="margin-top:0; margin-bottom: 10px;">Ads Master</h3>
                    <div id="gigaad-section">
                        <div id="cooldownTimerDisplay"></div>
                        <div class="action-buttons" style="display: flex; flex-direction: row; gap: 10px; margin-top: 20px;">
                            <button id="watchGigaAdBtn" class="action-btn" style="flex:1;"><i class="bi bi-play-circle-fill"></i> এড দেখুন <span id="gigaAdCountDisplay">0/50</span></button>
                            <button id="autoGigaAdBtn" class="action-btn" style="flex:1;"><i class="bi bi-robot"></i> অটো এড</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="section-title" style="margin-top:0; margin-bottom: 10px;">অন্যান্য বিজ্ঞাপন</h3>
                    <div id="other-ads-section">
                        <div id="adsterraCooldownTimerDisplay"></div>
                        <div class="ad-list-item">
                            <div class="info">
                                <div class="title">Ads King</div>
                                <div class="details">প্রতি ভিউতে <strong>+200</strong> কয়েন | <span id="adsterraCountDisplay">0/3</span> দেখা হয়েছে</div>
                            </div>
                            <button id="adsterraAdBtn" class="action-btn ad-btn ad-btn-adsterra">দেখুন</button>
                        </div>
                        <div class="ad-list-item">
                             <div class="info">
                                <div class="title">Ads Beginner</div>
                                <div class="details">প্রতি ভিউতে <strong>+50</strong> কয়েন | <span id="monetagCountDisplay">0/3</span> দেখা হয়েছে</div>
                            </div>
                            <button id="watchMonetagAdBtn" class="action-btn ad-btn ad-btn-monetag">দেখুন</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Withdraw View -->
        <div id="withdrawView" class="view">
            <header class="app-header header-with-back">
                <button class="back-btn" data-view-btn="mainView"><i class="bi bi-arrow-left-circle-fill"></i></button>
                <div class="header-title">কয়েন উত্তোলন</div>
                <div style="width: 44px;"></div>
            </header>
            <main class="content-area" style="padding-top: 20px;">
                <div class="card">
                    <form id="withdrawRequestForm">
                        <div class="balance-card" style="margin-bottom: 20px; padding: 15px;">
                            <p class="coin-name" style="font-size: 1rem;">আপনার বর্তমান ব্যালেন্স</p>
                            <h2 class="value" id="withdrawBalanceDisplay" style="font-size: 1.8rem;">0.00 কয়েন</h2>
                        </div>
                        
                        <p>সর্বনিম্ন উত্তোলন: <strong>10000</strong> কয়েন | 10000 কয়েন = <strong>100 BDT</strong></p>
                        <button type="button" id="showPolicyBtn" class="policy-btn">উত্তোলন নীতিমালা দেখুন</button>

                        <div class="form-group">
                            <label for="paymentMethod">পেমেন্ট মেথড</label>
                            <select id="paymentMethod" required><option value="bKash">বিকাশ</option><option value="Nagad">নগদ</option><option value="Rocket">রকেট</option></select>
                        </div>
                        <div class="form-group">
                            <label for="amount">কয়েনের পরিমাণ</label>
                            <input type="number" id="amount" placeholder="e.g., 50000" required>
                        </div>
                         <div class="form-group">
                            <label for="accountNumber">অ্যাকাউন্ট নম্বর</label>
                            <input type="text" id="accountNumber" placeholder="e.g., 017xxxxxxxx" required>
                        </div>
                        
                    </form>
                </div>
            </main>
        </div>

        <!-- History View -->
        <div id="historyView" class="view">
            <header class="app-header header-with-back">
                <button class="back-btn" data-view-btn="mainView"><i class="bi bi-arrow-left-circle-fill"></i></button>
                <div class="header-title">উত্তোলন ইতিহাস</div>
                <div style="width: 44px;"></div>
            </header>
            <main class="content-area" style="padding-top: 20px;">
                <div class="card">
                    <div id="historyListContainer">
                        <!-- History items will be dynamically inserted here -->
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Support View -->
        <div id="supportView" class="view">
            <header class="app-header header-with-back">
                <button class="back-btn" data-view-btn="mainView"><i class="bi bi-arrow-left-circle-fill"></i></button>
                <div class="header-title">সাপোর্ট সেন্টার</div>
                <div style="width: 44px;"></div>
            </header>
            <main class="content-area" style="padding-top: 20px;">
                <div class="card" style="display: flex; align-items: center; gap: 20px;">
                    <img src="https://i.ibb.co/gZ7rR7p/telegram.png" alt="Telegram" style="width: 50px; height: 50px; border-radius: 50%;">
                    <div>
                        <p style="font-size: 1.1rem; font-weight: 600;">টেলিগ্রাম গ্রুপ</p>
                        <p style="font-size: 0.9rem; color: var(--text-light);">যেকোনো আপডেট এবং আলোচনার জন্য আমাদের টেলিগ্রাম গ্রুপে যোগ দিন।</p>
                        <a href="https://t.me/fworker_official" target="_blank" class="action-btn" style="width: fit-content; padding: 8px 20px; font-size: 0.9rem; margin-top: 10px;"><i class="bi bi-telegram"></i> জয়েন করুন</a>
                    </div>
                </div>
                <div class="card" style="display: flex; align-items: center; gap: 20px;">
                    <img src="https://i.ibb.co/Q8Q2d6T/avatar.png" alt="Admin" style="width: 50px; height: 50px; border-radius: 50%;">
                    <div>
                        <p style="font-size: 1.1rem; font-weight: 600;">প্রধান এডমিন</p>
                        <p style="font-size: 0.9rem; color: var(--text-light);">সরাসরি এডমিনের সাথে কথা বলতে এখানে যোগাযোগ করুন।</p>
                        <a href="https://t.me/founder_of_ceo_fworker" target="_blank" class="action-btn" style="background-image: none; background-color: var(--success-color); width: fit-content; padding: 8px 20px; font-size: 0.9rem; margin-top: 10px;"><i class="bi bi-person-fill"></i> যোগাযোগ</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <a href="#" class="nav-item active" data-view-btn="mainView">
            <i class="bi bi-house-door-fill"></i>
            <span>হোম</span>
        </a>
        <a href="#" class="nav-item" data-view-btn="withdrawView">
            <i class="bi bi-wallet2"></i>
            <span>উত্তোলন</span>
        </a>
        <a href="#" class="nav-item" data-view-btn="historyView">
            <i class="bi bi-clock-history"></i>
            <span>ইতিহাস</span>
        </a>
        <a href="#" class="nav-item" data-view-btn="supportView">
            <i class="bi bi-headset"></i>
            <span>সাপোর্ট</span>
        </a>
    </div>

    <!-- Withdrawal Policy Modal -->
    <div id="policyModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">✅ উত্তোলন নীতিমালা</h3>
                <button id="closePolicyModalBtn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <ul>
                    <li><i class="bi bi-check-circle-fill"></i> এডমিন গ্রুপ এ নোটিশ দিলে তার পর কয়েন উইড্রো করবেন তাছাড়া উইড্রো করলে পেমেন্ট পাবেন না</li>
                   
                    <li><i class="bi bi-check-circle-fill"></i> উত্তোলন রিকোয়েস্ট করার পর অবশ্যই এডমিনের সাথে যোগাযোগ করতে হবে।</li>
                    <li><i class="bi bi-check-circle-fill"></i> শর্ত পূর্ণ হলেই টাকা প্রদান করা হবে, ইনশাল্লাহ।</li>
                </ul>
                <br>
                <p><strong>📢 তাই এখনই বেশি বেশি রেফারেল করুন এবং আপনার ইনকাম উত্তোলন করুন。</strong></p>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <div class="developer-credit"><a href="https://t.me/founder_of_ceo_fworker" target="_blank"><i class="bi bi-patch-check-fill" style="color: var(--primary-color); margin-right: 5px;"></i> Developed by <strong>Hason Raja</strong></a></div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const CONFIG = {
            GIGAAD_LIMIT: 50,
            GIGAAD_REWARD: 100,
            GIGAAD_COOLDOWN_MINUTES: 1,
            AUTO_AD_INTERVAL_MS: 2000,
            
            MONETAG_LIMIT_PER_SET: 3,
            MONETAG_REWARD: 50,
            MONETAG_AD_FUNCTION_NAME: 'show_9504240',
            MONETAG_REWARD_DELAY_MS: 15000,
            
            ADSTERRA_LIMIT: 3,
            ADSTERRA_COOLDOWN_HOURS: 3,
            ADSTERRA_REWARD: 200,
            ADSTERRA_WAIT_MINUTES: 1,
            ADSTERRA_DIRECT_LINK: 'https://www.profitableratecpm.com/njf9v72pa?key=d54f51f2eb6b58bc76542f0996052ee9',

            MIN_WITHDRAWAL_COINS: 100,
            BDT_PER_MIN_WITHDRAWAL: 1,

            COIN_NAME: 'X-Coin',
            YOUR_BOT_USERNAME: 'xerenplay_rbot',
            TELEGRAM_BOT_TOKEN: '8342598247:AAHeMXdT0du_fgNnqbfW5JK84i5KI_1LwEY', 
            TELEGRAM_CHAT_ID: '-1002417686942', 
            WITHDRAW_IMAGE_URL: 'https://i.ibb.co/PZSNq6HR/1000091003.jpg'
        };

        // --- STATE MANAGEMENT ---
        let state = {
            coins: 0.0,
            gigaAd: { count: 0, lastReset: null, completedAt: null },
            monetag: { count: 0, lastReset: null },
            adsterra: { count: 0, lastViewedAt: null },
            withdrawals: [],
            user: { id: null, firstName: 'Guest', lastName: 'User', joinDate: null },
            isAutoShowing: false,
            adInProgress: false,
        };

        const dom = {}; 

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            mapDomElements();
            loadState();
            initTelegramData();
            attachEventListeners();
            updateUI();
            checkAllCooldowns();
        }

        function mapDomElements() {
            const ids = [
                'userInfoProfilePic', 'userInfoName', 'userInfoId', 'joinDateDisplay', 
                'balanceDisplay', 'withdrawBalanceDisplay', 'withdrawRequestForm',
                'gigaAdCountDisplay', 'watchGigaAdBtn', 'autoGigaAdBtn', 'cooldownTimerDisplay', 
                'adsterraAdBtn', 'adsterraCountDisplay', 'adsterraCooldownTimerDisplay', 
                'watchMonetagAdBtn', 'monetagCountDisplay',
                'historyListContainer', 'showPolicyBtn', 'policyModal', 'closePolicyModalBtn',
                'supportBtn'
            ];
            ids.forEach(id => dom[id] = document.getElementById(id));
            dom.views = document.querySelectorAll('.view');
            dom.backBtns = document.querySelectorAll('.back-btn');
            dom.viewBtns = document.querySelectorAll('[data-view-btn]');
            dom.navItems = document.querySelectorAll('.nav-item');
        }

        function getTodayDateString() { return new Date().toISOString().slice(0, 10); }

        function loadState() {
            try {
                const savedState = localStorage.getItem('XEREN_PLAY_STATE_V6');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    state = { ...state, ...parsedState };

                    const today = getTodayDateString();
                    if (!state.gigaAd || state.gigaAd.lastReset !== today) state.gigaAd = { count: 0, lastReset: today, completedAt: null };
                    if (!state.monetag || state.monetag.lastReset !== today) state.monetag = { count: 0, lastReset: today };
                    if (!state.withdrawals) state.withdrawals = [];
                }
            } catch (e) { console.error("Could not load state:", e); }
        }

        function saveState() { 
            localStorage.setItem('XEREN_PLAY_STATE_V6', JSON.stringify(state)); 
        }

        // --- UI & NAVIGATION ---
        function showView(viewId) {
            dom.views.forEach(view => view.classList.remove('active'));
            const targetView = document.getElementById(viewId);
            if (targetView) { targetView.classList.add('active'); }
            
            // Update navigation active state
            dom.navItems.forEach(item => {
                if (item.dataset.viewBtn === viewId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            if (viewId === 'historyView') renderHistory();
        }

        function updateUI() {
            dom.balanceDisplay.textContent = Math.floor(state.coins).toLocaleString();
            dom.withdrawBalanceDisplay.textContent = `${Math.floor(state.coins).toLocaleString()} কয়েন`;
            dom.userInfoName.textContent = `${state.user.firstName} ${state.user.lastName || ''}`.trim();
            dom.userInfoId.textContent = `ID: ${state.user.id || 'N/A'}`;
            if (state.user.joinDate) dom.joinDateDisplay.textContent = `Joined: ${new Date(state.user.joinDate).toLocaleDateString('en-GB')}`;

            dom.gigaAdCountDisplay.textContent = `${state.gigaAd.count}/${CONFIG.GIGAAD_LIMIT}`;
            const isGigaSetCompleted = state.gigaAd.count >= CONFIG.GIGAAD_LIMIT;
            dom.watchGigaAdBtn.disabled = isGigaSetCompleted;
            dom.autoGigaAdBtn.disabled = isGigaSetCompleted;
            if (isGigaSetCompleted && state.isAutoShowing) toggleAutoGigaAd();

            dom.monetagCountDisplay.textContent = `${state.monetag.count}/${CONFIG.MONETAG_LIMIT_PER_SET}`;
            dom.watchMonetagAdBtn.disabled = state.monetag.count >= CONFIG.MONETAG_LIMIT_PER_SET;
            dom.adsterraCountDisplay.textContent = `${state.adsterra.count}/${CONFIG.ADSTERRA_LIMIT}`;
        }

        // --- TELEGRAM INTEGRATION ---
        function initTelegramData() {
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready(); tg.expand();
                    const user = tg.initDataUnsafe?.user;
                    if (user && user.id) {
                         if (!state.user.id) {
                            state.user.id = user.id;
                            state.user.firstName = user.first_name || 'Guest';
                            state.user.lastName = user.last_name || '';
                            state.user.joinDate = new Date().toISOString();
                         }
                         if(user.photo_url) dom.userInfoProfilePic.src = user.photo_url;
                        saveState(); updateUI();
                    }
                }
            } catch (error) { console.error("TG WebApp init failed:", error); }
        }
        
        // --- AD LOGIC ---
        function checkAllCooldowns() { checkGigaAdCooldown(); checkAdsterraCooldown(); }
        function handleGigaAd() {
            if (state.adInProgress || state.gigaAd.count >= CONFIG.GIGAAD_LIMIT) return;
            state.adInProgress = true;
            dom.watchGigaAdBtn.disabled = true;
            dom.watchGigaAdBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> লোড হচ্ছে...';
            if (typeof window.showGiga !== 'function') { alert('GigaAd লোড হতে সমস্যা হয়েছে।'); finalizeGigaAdAttempt(); return; }
            window.showGiga().then(() => {
                state.gigaAd.count++; state.coins += CONFIG.GIGAAD_REWARD;
                if (state.gigaAd.count >= CONFIG.GIGAAD_LIMIT) { state.gigaAd.completedAt = new Date().toISOString(); checkGigaAdCooldown(); }
            }).catch(e => { console.error("GigaAd failed:", e); }).finally(() => {
                finalizeGigaAdAttempt();
                if (state.isAutoShowing) {
                    if (state.gigaAd.count < CONFIG.GIGAAD_LIMIT) { setTimeout(handleGigaAd, CONFIG.AUTO_AD_INTERVAL_MS); } else { toggleAutoGigaAd(); }
                }
            });
        }
        function finalizeGigaAdAttempt() {
            state.adInProgress = false; saveState(); updateUI();
            dom.watchGigaAdBtn.innerHTML = `<i class="bi bi-play-circle-fill"></i> এড দেখুন (<span id="gigaAdCountDisplay">${state.gigaAd.count}/${CONFIG.GIGAAD_LIMIT}</span>)`;
        }
        function toggleAutoGigaAd() {
            state.isAutoShowing = !state.isAutoShowing;
            if (state.isAutoShowing) {
                dom.autoGigaAdBtn.classList.add('auto-ad-active');
                dom.autoGigaAdBtn.innerHTML = '<i class="bi bi-stop-circle-fill"></i> অটো বন্ধ করুন';
                handleGigaAd();
            } else {
                dom.autoGigaAdBtn.classList.remove('auto-ad-active');
                dom.autoGigaAdBtn.innerHTML = '<i class="bi bi-robot"></i> অটো এড';
            }
        }
        function checkGigaAdCooldown() {
            dom.cooldownTimerDisplay.style.display = 'none';
            if (state.gigaAd.completedAt) {
                const completedAt = new Date(state.gigaAd.completedAt);
                const resetTime = new Date(completedAt.getTime() + CONFIG.GIGAAD_COOLDOWN_MINUTES * 60000);
                if (Date.now() < resetTime.getTime()) {
                    const timeLeft = Math.ceil((resetTime.getTime() - Date.now()) / 1000);
                    dom.cooldownTimerDisplay.textContent = `⏳ পরবর্তী এড দেখতে ${timeLeft} সেকেন্ড অপেক্ষা করুন`;
                    dom.cooldownTimerDisplay.style.display = 'block';
                    setTimeout(checkGigaAdCooldown, 1000);
                } else {
                    const today = getTodayDateString();
                    if (state.gigaAd.lastReset !== today) { state.gigaAd = { count: 0, lastReset: today, completedAt: null }; saveState(); updateUI(); }
                }
            }
        }
        function handleMonetagAd() {
            if (state.monetag.count >= CONFIG.MONETAG_LIMIT_PER_SET) return;
            if (typeof window[CONFIG.MONETAG_AD_FUNCTION_NAME] !== 'function') { alert('Monetag Ad লোড হতে সমস্যা হয়েছে।'); return; }
            state.monetag.count++; saveState(); updateUI();
            window[CONFIG.MONETAG_AD_FUNCTION_NAME]();
            setTimeout(() => { state.coins += CONFIG.MONETAG_REWARD; saveState(); updateUI(); }, CONFIG.MONETAG_REWARD_DELAY_MS);
        }
        function handleAdsterraAd() {
            if (state.adsterra.count >= CONFIG.ADSTERRA_LIMIT) return;
            state.adsterra.count++; state.adsterra.lastViewedAt = new Date().toISOString();
            saveState(); updateUI();
            window.open(CONFIG.ADSTERRA_DIRECT_LINK, '_blank');
            setTimeout(() => { state.coins += CONFIG.ADSTERRA_REWARD; saveState(); updateUI(); }, 60000);
        }
        function checkAdsterraCooldown() {
            dom.adsterraCooldownTimerDisplay.style.display = 'none';
            if (state.adsterra.lastViewedAt) {
                const lastViewedAt = new Date(state.adsterra.lastViewedAt);
                const resetTime = new Date(lastViewedAt.getTime() + CONFIG.ADSTERRA_COOLDOWN_HOURS * 3600000);
                if (Date.now() < resetTime.getTime()) {
                    const hoursLeft = ((resetTime.getTime() - Date.now()) / 3600000).toFixed(1);
                    dom.adsterraCooldownTimerDisplay.textContent = `⏳ পরবর্তী Adsterra Ad দেখতে ${hoursLeft} ঘন্টা অপেক্ষা করুন`;
                    dom.adsterraCooldownTimerDisplay.style.display = 'block';
                    setTimeout(checkAdsterraCooldown, 60000);
                }
            }
        }

        // --- WITHDRAWAL ---
        function handleWithdrawRequest(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('amount').value);
            const paymentMethod = document.getElementById('paymentMethod').value;
            const accountNumber = document.getElementById('accountNumber').value;
            if (amount < CONFIG.MIN_WITHDRAWAL_COINS) {
                alert(`সর্বনিম্ন উত্তোলন ${CONFIG.MIN_WITHDRAWAL_COINS} কয়েন`);
                return;
            }
            if (state.coins < amount) {
                alert('আপনার ব্যালেন্স অপর্যাপ্ত');
                return;
            }
            const withdrawal = {
                id: Date.now(),
                amount,
                paymentMethod,
                accountNumber,
                status: 'pending',
                date: new Date().toISOString(),
                bdtAmount: Math.floor((amount / CONFIG.MIN_WITHDRAWAL_COINS) * CONFIG.BDT_PER_MIN_WITHDRAWAL)
            };
            state.withdrawals.unshift(withdrawal);
            state.coins -= amount;
            saveState(); updateUI();
            alert('✅ আপনার উত্তোলন রিকোয়েস্ট সাবমিট হয়েছে। এডমিনের সাথে যোগাযোগ করুন।');
            document.getElementById('withdrawRequestForm').reset();
            showView('historyView');
        }
        function renderHistory() {
            if (!state.withdrawals || state.withdrawals.length === 0) {
                dom.historyListContainer.innerHTML = `<div class="no-history"><i class="bi bi-inbox" style="font-size: 3rem;"></i><p>কোনো উত্তোলনের ইতিহাস নেই</p></div>`;
                return;
            }
            dom.historyListContainer.innerHTML = state.withdrawals.map(withdrawal => `
                <div class="history-item">
                    <div class="details">
                        <div class="amount">${withdrawal.amount.toLocaleString()} ${CONFIG.COIN_NAME}</div>
                        <div class="info">${withdrawal.paymentMethod} - ${withdrawal.accountNumber} | ${new Date(withdrawal.date).toLocaleDateString('en-GB')}</div>
                    </div>
                    <div class="status ${withdrawal.status}">${withdrawal.status === 'pending' ? '⏳ রিকোয়েস্ট পাঠানো হয়েছে' : '✅ সম্পূর্ণ'}</div>
                </div>
            `).join('');
        }

        // --- EVENT LISTENERS ---
        function attachEventListeners() {
            dom.watchGigaAdBtn.addEventListener('click', handleGigaAd);
            dom.autoGigaAdBtn.addEventListener('click', toggleAutoGigaAd);
            dom.watchMonetagAdBtn.addEventListener('click', handleMonetagAd);
            dom.adsterraAdBtn.addEventListener('click', handleAdsterraAd);
            dom.withdrawRequestForm.addEventListener('submit', handleWithdrawRequest);
            dom.showPolicyBtn.addEventListener('click', () => { dom.policyModal.classList.add('show'); });
            dom.closePolicyModalBtn.addEventListener('click', () => { dom.policyModal.classList.remove('show'); });
            dom.policyModal.addEventListener('click', (e) => { if (e.target === dom.policyModal) dom.policyModal.classList.remove('show'); });
            dom.viewBtns.forEach(btn => { btn.addEventListener('click', (e) => { e.preventDefault(); showView(btn.dataset.viewBtn); }); });
        }
    </script>
</body>
</html>
<script async="async" data-cfasync="false" src="//pl26372025.revenuecpmgate.com/b7611652d6af11cf1180d86165832913/invoke.js"></script>
<div id="container-b7611652d6af11cf1180d86165832913"></div>